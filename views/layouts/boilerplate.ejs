<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>furniture-store</title> 
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/rating.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
    
  </style>
    
</head>
<body>
    <%- include("../includes/navbar.ejs")%>
    <% if(currUser) {%><h4>hi <%=currUser.username  %></h4><% } %>
    <div style="margin: 15px;"><%- include("../includes/flash.ejs")%><%-body%></div>
    <%- include("../includes/footer.ejs")%>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
     <script src="/js/script.js"></script>
     <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<% if (typeof alllistings !== 'undefined') { %>
 <script>
        // Sample listings data
        const listingsData =<%- JSON.stringify(alllistings) %>;

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchDropdown = document.getElementById('searchDropdown');

        function performSearch() {
            const query = searchInput.value.toLowerCase().trim();
            searchDropdown.innerHTML = '';

            if (query === '') {
                searchDropdown.classList.remove('show');
                return;
            }

            const results = listingsData.filter(item =>
                item.name.toLowerCase().includes(query) ||
                item.brand.toLowerCase().includes(query) ||
                item.category.toLowerCase().includes(query) ||
                item.sub_cat.toLowerCase().includes(query)
            );

            if (results.length === 0) {
                searchDropdown.innerHTML = '<div class="search-result-item">No results found.</div>';
            } else {
                results.forEach(item => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `
                        <h6>${item.name}</h6>
                        <p>Brand: ${item.brand} | Category: ${item.category} | Subcategory: ${item.sub_cat}</p>
                    `;
                    resultItem.addEventListener('click', () => {
                        // Redirect to product page with item ID
                        window.location.href = `/listings/${item._id}`;
                        searchDropdown.classList.remove('show');
                        searchInput.value = item.name;
                    });
                    searchDropdown.appendChild(resultItem);
                });
            }

            searchDropdown.classList.add('show');
        }

        // Event listeners for search input
        searchInput.addEventListener('input', performSearch);
        searchInput.addEventListener('focus', performSearch);

        // Hide dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
                searchDropdown.classList.remove('show');
            }
        });

        
    </script>  
    <% } %>
     
</body>
</html>

